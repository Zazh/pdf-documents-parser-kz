{% extends 'base.html' %}

{% block title %}–î–æ–∫—É–º–µ–Ω—Ç #{{ document.id }} - PDF Parser{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="bi bi-file-earmark-text"></i> –ù–æ–º–µ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ #{{ document.id }}
                </h4>
                <small>{{ document.created_at|date:"d.m.Y H:i" }}</small>
            </div>
            
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
<!--                        <h5>–î–∞–Ω–Ω—ã–µ:</h5>-->
                        
                        <div class="row">
                            <div class="col-md-12">
                                <h6 class="text-primary">üë§ –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h6>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong>–§–∞–º–∏–ª–∏—è:</strong></td>
                                        <td>
                                            {% if document.last_name %}
                                                <span class="badge bg-success">{{ document.last_name }}</span>
                                            {% else %}
                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>–ò–º—è:</strong></td>
                                        <td>
                                            {% if document.first_name %}
                                                <span class="badge bg-success">{{ document.first_name }}</span>
                                            {% else %}
                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>–û—Ç—á–µ—Å—Ç–≤–æ:</strong></td>
                                        <td>
                                            {% if document.patronymic %}
                                                <span class="badge bg-success">{{ document.patronymic }}</span>
                                            {% else %}
                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</span>
                                            {% endif %}
                                        </td>
                                    </tr>
<!--                                    <tr>-->
<!--                                        <td><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong></td>-->
<!--                                        <td>-->
<!--                                            {% if document.birth_date %}-->
<!--                                                <code class="bg-light p-1 rounded">{{ document.birth_date }}</code>-->
<!--                                            {% else %}-->
<!--                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–∞</span>-->
<!--                                            {% endif %}-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                    <tr>
                                        <td><strong>–ò–ò–ù:</strong></td>
                                        <td>
                                            {% if document.iin %}
                                                <code class="bg-light p-2 rounded">{{ document.iin }}</code>
                                            {% else %}
                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω</span>
                                            {% endif %}
                                        </td>
                                    </tr>
<!--                                    <tr>-->
<!--                                        <td><strong>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong></td>-->
<!--                                        <td>-->
<!--                                            {% if document.birth_place %}-->
<!--                                                <span class="badge bg-info">{{ document.birth_place }}</span>-->
<!--                                            {% else %}-->
<!--                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–æ</span>-->
<!--                                            {% endif %}-->
<!--                                        </td>-->
<!--                                    </tr>-->
<!--                                    <tr>-->
<!--                                        <td><strong>–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</strong></td>-->
<!--                                        <td>-->
<!--                                            {% if document.nationality %}-->
<!--                                                <span class="badge bg-secondary">{{ document.nationality }}</span>-->
<!--                                            {% else %}-->
<!--                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–∞</span>-->
<!--                                            {% endif %}-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                </table>
                            </div>

                            <div class="col-md-12">
                                <h6 class="text-warning">üìÑ –î–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h6>
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong>–î–∞—Ç–∞:</strong></td>
                                        <td>
                                            {% if document.test_date %}
                                                <code class="bg-light p-1 rounded">{{ document.test_date }}</code>
                                            {% else %}
                                                <span class="text-muted">–ù–µ –Ω–∞–π–¥–µ–Ω–∞</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            {% if document.pdf_file %}
                            <div class="mt-4 col-4">
                                <a href="{{ document.pdf_file.url }}" target="_blank" class="btn btn-outline-secondary">
                                    <i class="bi bi-file-pdf"></i> –û—Ç–∫—Ä—ã—Ç—å PDF
                                </a>
                            </div>
                            {% endif %}
                            <div class="mt-4 col-4">
                                <a href="{% url 'document_export_pdf' document.pk %}" class="btn btn-outline-success">
                                  <i class="bi bi-filetype-pdf"></i> –í—ã–≥—Ä—É–∑–∏—Ç—å PDF
                                </a>
                            </div>
                        </div>



                        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
<!--                        <div class="mt-4">-->
<!--                            <button class="btn btn-outline-info btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#debugInfo">-->
<!--                                <i class="bi bi-bug"></i> –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é-->
<!--                            </button>-->
<!--                            <div class="collapse mt-2" id="debugInfo">-->
<!--                                <div class="card card-body bg-light">-->
<!--                                    <small>-->
<!--                                        <strong>–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ PDF:</strong><br>-->
<!--                                        <pre style="white-space: pre-wrap; font-size: 11px;">{{ document.raw_text|default:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" }}</pre>-->
<!--                                    </small>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
                    </div>

                    <div class="col-md-4">
                        {% if document.photo %}
                            <div class="text-center">
                                <img src="{{ document.photo.url }}" alt="–§–æ—Ç–æ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞"
                                     class="img-fluid photo-preview">
                                <div class="mt-2">
                                    <a href="{{ document.photo.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-zoom-in"></i> –£–≤–µ–ª–∏—á–∏—Ç—å
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center text-muted">
                                <i class="bi bi-image display-4 mb-2"></i>
                                <p>–§–æ—Ç–æ –Ω–µ –∏–∑–≤–ª–µ—á–µ–Ω–æ</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-gear"></i> –î–µ–π—Å—Ç–≤–∏—è</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'upload_document' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π
                    </a>
                    <a href="{% url 'document_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-list"></i> –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
                    </a>
                    <a href="{% url 'admin:documents_document_change' document.pk %}" class="btn btn-outline-warning">
                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> –î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h6>
            </div>
            <div class="card-body">
                <small class="text-muted">
                    <div class="row">
                        <div class="col-12">
                            <form method="post" action="{% url 'set_test_date' document.pk %}" class="row g-2 align-items-end">
                              {% csrf_token %}
                              <div class="col-12">
                                <label for="testDateInput" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</label>
                                <input
                                  type="datetime-local"
                                  class="form-control"
                                  id="testDateInput"
                                  name="test_date"
                                  value="{{ document.test_date|date:'Y-m-d\\TH:i' }}"
                                  required
                                >
                                <div class="form-text">
                                  –¢–µ–∫—É—â–∞—è: {{ document.test_date|date:"d.m.Y H:i" }}{% if not document.test_date %} ‚Äî –Ω–µ –∑–∞–¥–∞–Ω–∞{% endif %}
                                </div>
                              </div>
                              <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100">
                                  <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                              </div>
                            </form>
                        </div>
                    </div>
                </small>
            </div>
        </div>

<!--        <div class="card mt-3">-->
<!--            <div class="card-header">-->
<!--                <h6 class="mb-0"><i class="bi bi-info-circle"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è</h6>-->
<!--            </div>-->
<!--            <div class="card-body">-->
<!--                <small class="text-muted">-->
<!--                    <div class="row">-->
<!--                        <div class="col-6">-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–§–∞–º–∏–ª–∏—è:</span>-->
<!--                                <span>-->
<!--                                    {% if document.last_name %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ò–º—è:</span>-->
<!--                                <span>-->
<!--                                    {% if document.first_name %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–û—Ç—á–µ—Å—Ç–≤–æ:</span>-->
<!--                                <span>-->
<!--                                    {% if document.patronymic %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>-->
<!--                                <span>-->
<!--                                    {% if document.birth_date %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ò–ò–ù:</span>-->
<!--                                <span>-->
<!--                                    {% if document.iin %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–§–æ—Ç–æ:</span>-->
<!--                                <span>-->
<!--                                    {% if document.photo %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-6">-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ú–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>-->
<!--                                <span>-->
<!--                                    {% if document.birth_place %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</span>-->
<!--                                <span>-->
<!--                                    {% if document.nationality %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:</span>-->
<!--                                <span>-->
<!--                                    {% if document.document_number %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–ö–µ–º –≤—ã–¥–∞–Ω:</span>-->
<!--                                <span>-->
<!--                                    {% if document.issued_by %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</span>-->
<!--                                <span>-->
<!--                                    {% if document.issue_date %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                            <div class="d-flex justify-content-between">-->
<!--                                <span>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</span>-->
<!--                                <span>-->
<!--                                    {% if document.expiry_date %}-->
<!--                                        <i class="bi bi-check-circle text-success"></i>-->
<!--                                    {% else %}-->
<!--                                        <i class="bi bi-x-circle text-danger"></i>-->
<!--                                    {% endif %}-->
<!--                                </span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </small>-->
<!--            </div>-->
<!--        </div>-->
    </div>
</div>

<div class="mt-4 text-center">
    <a href="{% url 'document_list' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
    </a>
</div>
{% endblock %}